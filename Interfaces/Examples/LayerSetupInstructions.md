# Инструкция по настройке слоев для предотвращения пересечений

## Проблема
Предметы пересекаются друг с другом, потому что система проверяет коллизии со всеми объектами, включая поверхности.

## Решение
Создать правильную систему слоев и настроить маски коллизий.

## Шаг 1: Создание слоев в Unity

1. Откройте **Edit → Project Settings → Tags and Layers**
2. В разделе **User Layers 8-31** добавьте следующие слои:
   - **StaticEnvironment** (слой 8) - для пола, стен, статичного окружения
   - **Furniture** (слой 9) - для перемещаемых предметов мебели
   - **Surface** (слой 10) - для поверхностей (столы, тумбы)
   - **IgnoreCollision** (слой 11) - для декоративных объектов

## Шаг 2: Назначение слоев объектам

### На сцене:
- **Пол, стены** → слой **StaticEnvironment**
- **Столы, тумбы, поверхности** → слой **Surface**
- **Перемещаемые предметы** → слой **Furniture**
- **Декоративные объекты** → слой **IgnoreCollision**

### В префабах:
- **Префабы предметов** → слой **Furniture**
- **Префабы поверхностей** → слой **Surface**

## Шаг 3: Настройка валидатора

1. Добавьте компонент **LayerSetupHelper** на сцену
2. В инспекторе нажмите правой кнопкой на **LayerSetupHelper**
3. Выберите **"Настроить маски коллизий"**

Это автоматически настроит:
- **CollisionCheckMask** = StaticEnvironment + Furniture (проверяет только мебель и окружение)
- **SurfaceCheckMask** = Surface (проверяет только поверхности)
- **PreventObjectOverlap** = true
- **UseStrictValidation** = true

## Шаг 4: Проверка настроек

1. Выберите **"Проверить текущие настройки"** в **LayerSetupHelper**
2. Убедитесь, что маски настроены правильно
3. Выберите **"Назначить слои объектам на сцене"** для диагностики

## Логика работы

### Проверка коллизий (CheckCollisions):
- Проверяет только объекты на слоях **StaticEnvironment** и **Furniture**
- Исключает поверхности, превью объекты, игнорируемые слои

### Проверка наложений (CheckObjectOverlap):
- Проверяет только объекты на слоях **StaticEnvironment** и **Furniture**
- Использует строгую валидацию для предотвращения пересечений

### Проверка поверхностей (CheckSurfaceValidity):
- Проверяет только объекты на слое **Surface**
- Использует **PlacementLayerComponent** для определения валидности

## Диагностика

Если предметы все еще пересекаются:

1. **Проверьте слои объектов**:
   - Используйте **"Назначить слои объектам на сцене"**
   - Убедитесь, что перемещаемые предметы на слое **Furniture**

2. **Проверьте настройки валидатора**:
   - Используйте **"Проверить текущие настройки"**
   - Убедитесь, что **UseStrictValidation = true**

3. **Проверьте логи**:
   - Включите подробное логирование
   - Ищите сообщения о коллизиях и наложениях

## Примеры логов

### Правильная работа:
```
✅ Исключаем поверхность из коллизий: Table
✅ Наложений нет
```

### Проблема:
```
❌ Обнаружено наложение с Chair
❌ Найдено 1 наложений
```

## Альтернативное решение

Если создание слоев затруднительно, можно использовать теги:

1. Создайте теги: **"Furniture"**, **"Surface"**, **"IgnoreCollision"**
2. Назначьте теги объектам
3. Настройте **IgnoredTags** в конфигурации валидатора

Но использование слоев более эффективно и рекомендуется.
